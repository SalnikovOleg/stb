{assign var=parent value=0}
{counter start=0 skip=1 assign=count}

{section name = i loop = $list}

{if $parent != $list[i].parent}
{counter assign=count}
{assign var=parent value=$list[i].parent}
{if !$smarty.section.i.first}</ul></div></div>{/if}
<div class="cat_h" style="margin-left:{math equation=5+248*($count-1)}px; padding:0;">
<div class="cat_head" style="background:url(./templates/{$CURRENT_TEMPLATE}images/head_{$count}.jpg) repeat-x center">{$list[i].parent_name}</div>
<div style="background:url({$img_folder}cat_img_{$count}.jpg) no-repeat center top; height:118px; width:239px"></div>
<div class="cat_list cat_list_{$count}">
<ul>
{/if}

<li><div class="cat_item"><a href="{if $list[i].href}{$list[i].href}{else}{$list[i].url}{/if}">{$list[i].name}</a></div></li>
{if $smarty.section.i.last}
</ul>
</div>
</div>
{/if}

{/section}

{literal}
<script type="text/javascript">
 $(document).ready(function(){ // выравнивание высоты блоков катогорий
 var h=0;
 $('.cat_list').each(function(){  
	if ($(this).height() > h) h = $(this).height(); 
 });
$('.cat_list').css('height', h+'px');
if ($('#top_wrap').height() < (170+h))
	$('#top_wrap').css('height', (170+h)+'px');
}); 
</script>
{/literal}
